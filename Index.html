<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Firebase Admin SDK JSON to .env Converter</title>
<style>
  body { font-family: Arial, sans-serif; margin: 2rem; background: #f5f5f5; }
  h2 { color: #333; }
  input, button { font-size: 1rem; padding: 0.5rem; margin: 0.5rem 0; }
  pre { background: #222; color: #eee; padding: 1rem; white-space: pre-wrap; word-break: break-word; }
</style>
</head>
<body>
  <h2>Firebase Admin SDK JSON â†’ .env Converter</h2>
  <input type="file" id="fileInput" accept=".json" />
  <br />
  <button id="downloadBtn" disabled>Download .env</button>
  <pre id="output"></pre>

<script>
(() => {
  const fileInput = document.getElementById("fileInput");
  const downloadBtn = document.getElementById("downloadBtn");
  const output = document.getElementById("output");
  let envContent = "";

  // Mapping JSON keys to FIREBASE_ env keys
  const keyMap = {
    type: "FIREBASE_TYPE",
    project_id: "FIREBASE_PROJECT_ID",
    private_key_id: "FIREBASE_PRIVATE_KEY_ID",
    private_key: "FIREBASE_PRIVATE_KEY",
    client_email: "FIREBASE_CLIENT_EMAIL",
    client_id: "FIREBASE_CLIENT_ID",
    auth_uri: "FIREBASE_AUTH_URI",
    token_uri: "FIREBASE_TOKEN_URI",
    auth_provider_x509_cert_url: "FIREBASE_AUTH_PROVIDER_X509_CERT_URL",
    client_x509_cert_url: "FIREBASE_CLIENT_X509_CERT_URL",
  };

  fileInput.addEventListener("change", () => {
    const file = fileInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      try {
        const json = JSON.parse(reader.result);
        const lines = [];

        for (const [jsonKey, envKey] of Object.entries(keyMap)) {
          let val = json[jsonKey];
          if (val === undefined) continue;

          // For private_key, preserve newlines as \n inside quotes
          if (jsonKey === "private_key") {
            // Escape backslashes and newlines for .env multiline safety
            val = val.replace(/\\n/g, "\\n").replace(/\n/g, "\\n");
            val = `"${val}"`;
          } else if (typeof val === "string") {
            // Quote any string containing spaces or special chars
            if (val.includes(" ") || val.includes("#") || val.includes('"')) {
              val = `"${val.replace(/"/g, '\\"')}"`;
            }
          }

          lines.push(`${envKey}=${val}`);
        }

        envContent = lines.join("\n");
        output.textContent = envContent;
        downloadBtn.disabled = false;
      } catch (err) {
        alert("Invalid JSON file: " + err.message);
        output.textContent = "";
        downloadBtn.disabled = true;
      }
    };
    reader.readAsText(file);
  });

  downloadBtn.addEventListener("click", () => {
    if (!envContent) return;

    const blob = new Blob([envContent], { type: "text/plain" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = ".env";
    link.click();
    URL.revokeObjectURL(link.href);
  });
})();
</script>
</body>
</html>
